@using TheNextLevel.Presentation.Components.Buttons
@using TheNextLevel.Presentation.Dialogs
@inject NavigationManager Navigation

@implements IDisposable

<footer class="footer">
    <div class="footer-content">
        <nav class="footer-nav">
            <a href="/" class="footer-link @GetActiveClass("/")">Home</a>

            <a href="/settings" class="footer-link @GetActiveClass("/settings")">Settings</a>
        </nav>
    </div>
</footer>

<NewProjectDialog
    IsVisible="_showProjectDialog"
    ExistingProject="_editingProject"
    OnResult="HandleProjectSaved"
    OnCancel="CloseProjectDialog" />

<NewTaskDialog
    IsVisible="_showTaskDialog"
    ExistingTask="_editingTask"
    OnResult="HandleTaskSaved"
    OnCancel="CloseTaskDialog" />

@code {
    protected override void OnInitialized()
    {
        Navigation.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, Microsoft.AspNetCore.Components.Routing.LocationChangedEventArgs e)
    {
        StateHasChanged();
    }

    private string GetActiveClass(string path)
    {
        var currentPath = new Uri(Navigation.Uri).AbsolutePath;
        return currentPath == path ? "active" : "";
    }

    #region Project Dialog
    private bool _showProjectDialog = false;
    private ProjectDto? _editingProject = null;
    private void OpenNewProjectDialog()
    {
        _editingProject = null;
        _showProjectDialog = true;
    }
    private void CloseProjectDialog()
    {
        _showProjectDialog = false;
    }
    private void HandleProjectSaved(ProjectDto project)
    {
        _showProjectDialog = false;
        // Handle post-save logic if needed
    }
    #endregion

    #region Task Dialog
    private bool _showTaskDialog = false;
    private TaskDto? _editingTask = null;
    private void OpenNewTaskDialog()
    {
        _editingTask = null;
        _showTaskDialog = true;
    }
    private void CloseTaskDialog()
    {
        _showTaskDialog = false;
    }
    private void HandleTaskSaved(TaskDto task)
    {
        _showTaskDialog = false;
        // Handle post-save logic if needed
    }
    #endregion

    public void Dispose()
    {
        Navigation.LocationChanged -= OnLocationChanged;
    }
}